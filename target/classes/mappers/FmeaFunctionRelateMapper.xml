<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rb.fmea.dao.FmeaFunctionRelateMapper" >
  <resultMap id="BaseResultMap" type="com.rb.fmea.entities.FmeaFunctionRelate" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="function_superior_id" property="functionSuperiorId" jdbcType="INTEGER" />
    <result column="function_next_id" property="functionNextId" jdbcType="INTEGER" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from fmea_function_relate
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.rb.fmea.entities.FmeaFunctionRelate" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ROWID()
    </selectKey>
    insert into fmea_function_relate (function_superior_id, function_next_id
      )
    values (#{functionSuperiorId,jdbcType=INTEGER}, #{functionNextId,jdbcType=INTEGER}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.rb.fmea.entities.FmeaFunctionRelate" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update fmea_function_relate
    set function_superior_id = #{functionSuperiorId,jdbcType=INTEGER},
      function_next_id = #{functionNextId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, function_superior_id, function_next_id
    from fmea_function_relate
    where id = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, function_superior_id, function_next_id
    from fmea_function_relate
  </select>




<!--
    根据功能关系表查询当前功能对应的所有功能，然后查询出每个功能对应的结构，查询下级功能
-->
   <!-- <select id="selectNextByStructureId"  resultType="com.rb.fmea.dto.StructureFunctionDto" >
       select m.id,fd.integrate,m.function_require functionRequire,s.id structureId,s.structure_name structureName,s.structure_desc structureDesc from
    (select ff.id,ff.function_standard,ff.fmea_structure_id,ff.function_require
    from fmea_function_relate ffr inner join fmea_function ff on ffr.function_next_id=ff.id where ffr.function_superior_id= #{structureId}) m
    left join fmea_structure s on m.fmea_structure_id=s.id left join function_standard fd on m.function_standard=fd.id
    </select>-->
    <select id="selectNextByStructureId"  resultType="com.rb.fmea.dto.StructureFunctionDto" >
       select m.id,m.function_standard integrate,m.function_require functionRequire,s.id structureId,s.structure_name structureName,s.structure_desc structureDesc from
    (select ff.id,ff.function_standard,ff.fmea_structure_id,ff.function_require
    from fmea_function_relate ffr inner join fmea_function ff on ffr.function_next_id=ff.id where ffr.function_superior_id= #{structureId}) m
    left join fmea_structure s on m.fmea_structure_id=s.id
    </select>


    <!--
    根据功能关系表查询当前功能对应的所有功能，然后查询出每个功能对应的结构，查询上级功能
-->
    <!--<select id="selectParentByStructureId"  resultType="com.rb.fmea.dto.StructureFunctionDto" >
      select m.id,fd.integrate,m.function_require functionRequire,s.id structureId,s.structure_name structureName,s.structure_desc structureDesc from
    (select ff.id,ff.function_standard,ff.fmea_structure_id,ff.function_require
    from fmea_function_relate ffr inner join fmea_function ff on ffr.function_superior_id=ff.id where ffr.function_next_id= #{structureId}) m
    left join fmea_structure s on m.fmea_structure_id=s.id left join function_standard fd on m.function_standard=fd.id;
    </select>-->
    <select id="selectParentByStructureId"  resultType="com.rb.fmea.dto.StructureFunctionDto" >
      select m.id,m.function_standard integrate,m.function_require functionRequire,s.id structureId,s.structure_name structureName,s.structure_desc structureDesc from
    (select ff.id,ff.function_standard,ff.fmea_structure_id,ff.function_require
    from fmea_function_relate ffr inner join fmea_function ff on ffr.function_superior_id=ff.id where ffr.function_next_id= #{structureId}) m
    left join fmea_structure s on m.fmea_structure_id=s.id
    </select>

    <select id="selectBySuperiorIdAndNextId" resultMap="BaseResultMap" >
        select id, function_superior_id, function_next_id
        from fmea_function_relate where function_next_id=#{nextId} and function_superior_id=#{superiorId}
    </select>
</mapper>